# Команда /trade — Дизайн

## Цель

Добавить текстовую команду `/trade` для быстрого создания, просмотра и отмены лимитных ордеров на Stellar DEX (аналогично `/swap` для мгновенного обмена).

## Команды

### 1. Создание ордера

**Форматы:**

```
/trade <сумма> <продаём> <получаем> <цена>
/trade <сумма> <продаём> <сумма_получения> <получаем>
```

**Примеры:**

```
/trade 10 MTL USDT 0.25      → продать 10 MTL по 0.25 USDT за штуку (получить 2.5 USDT)
/trade 10 MTL 2.5 USDT       → продать 10 MTL, получить 2.5 USDT (цена 0.25)
```

**Логика парсинга:**

| Аргументы | Паттерн | Интерпретация |
|-----------|---------|---------------|
| 4 args, последний — число | `amount asset1 asset2 price` | Цена за единицу |
| 4 args, третий — число | `amount asset1 receive_amount asset2` | Сумма получения |

**Валидация:**

- Проверка trustline на оба токена (как в `/swap`)
- Проверка баланса продаваемого токена
- Проверка лимита 5000 (если `can_5000 == 0`)
- Проверка что токены разные
- Проверка что суммы > 0

### 2. Просмотр ордеров

```
/trade list
```

Показывает список активных ордеров пользователя:

```
Ваши ордера:
1. #12345: 10 MTL → 2.5 USDT (0.25/шт)
2. #12346: 100 EURMTL → 105 USDC (1.05/шт)
```

### 3. Отмена ордера

```
/trade cancel <offer_id>
```

**Пример:**

```
/trade cancel 12345
```

Показывает подтверждение с кнопками Да/Нет перед отменой.

## Технические детали

### Файлы для изменения

- `routers/trade.py` — добавить обработчик команды `/trade`

### Переиспользование

- `ManageOfferUseCase` — уже есть, используется для создания/удаления ордеров
- `get_kb_yesno_send_xdr` — для подтверждения
- `stellar_service.get_selling_offers` — для списка ордеров
- Валидация trustline — взять логику из `swap.py`

### FSM States

Не требуется — команда полностью self-contained (все параметры в одном сообщении).

## Не включено (YAGNI)

- Редактирование ордера через команду (есть через меню)
- Создание нескольких ордеров за раз
- Фильтрация списка ордеров по токену
